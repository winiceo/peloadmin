{"version":3,"sources":["../../../app/middleware/locals.js"],"names":["Loader","require","module","exports","options","app","assets","logger","config","mini_assets","e","error","ctx","next","locals","csrf"],"mappings":";;;;AACA,IAAMA,SAASC,QAAQ,QAAR,CAAf;;AAEAC,OAAOC,OAAP,GAAiB,UAACC,OAAD,EAAUC,GAAV,EAAkB;AAC/B;AACA,QAAIC,SAAS,EAAb;AACA,QAAMC,SAASF,IAAIE,MAAnB;;AAEA,QAAIF,IAAIG,MAAJ,CAAWC,WAAf,EAA4B;AACxB,YAAI;AACAH,qBAASL,QAAQ,gBAAR,CAAT;AACH,SAFD,CAEE,OAAOS,CAAP,EAAU;AACRH,mBAAOI,KAAP,CACI,0EADJ;AAGA,kBAAMD,CAAN;AACH;AACJ;;AAED;AACA;AAAA,2EAAO,iBAAeE,GAAf,EAAoBC,IAApB;AAAA;AAAA;AAAA;AAAA;AACHD,gCAAIE,MAAJ,CAAWN,MAAX,GAAoBH,IAAIG,MAAxB;AACAI,gCAAIE,MAAJ,CAAWd,MAAX,GAAoBA,MAApB;AACAY,gCAAIE,MAAJ,CAAWR,MAAX,GAAoBA,MAApB;AACAM,gCAAIE,MAAJ,CAAWC,IAAX,GAAkBH,IAAIG,IAAtB;AAJG;AAAA,mCAKGF,MALH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;;AAAA;AAAA;AAAA;AAAA;AAOH,CAxBD;;AA0BA;AACA;AACA;AACA;AACA;AACA","file":"locals.js","sourcesContent":["\nconst Loader = require('loader');\n\nmodule.exports = (options, app) => {\n    // assets\n    let assets = {};\n    const logger = app.logger;\n\n    if (app.config.mini_assets) {\n        try {\n            assets = require('../assets.json');\n        } catch (e) {\n            logger.error(\n                'You must execute `make build` before start app when mini_assets is true.'\n            );\n            throw e;\n        }\n    }\n\n    // 验证用户是否登录\n    return async function(ctx, next) {\n        ctx.locals.config = app.config;\n        ctx.locals.Loader = Loader;\n        ctx.locals.assets = assets;\n        ctx.locals.csrf = ctx.csrf;\n        await next();\n    };\n};\n\n// app.use(errorPageMiddleware.errorPage);\n// _.extend(app.locals, require('./common/render_helper'));\n// app.use(function (req, res, next) {\n//   res.locals.csrf = req.csrfToken ? req.csrfToken() : '';\n//   next();\n// });\n"]}